"use strict";angular.module("zlAudio",[]).constant("zlAudioDomUid",function(){for(var t="",e=0;e<8;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t}()).directive("zlAudio",["$compile","$q","zlAudio",function(t,e,o){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:["$scope","$attrs","$element","$timeout",function(t,e,n,i){function r(){u=o.load(e.zlAudio,t),t.$audio=u,u.unbind()}var u;t.disablePreload||r(),n.on("click",function(){t.clickPlay!==!1&&(t.disablePreload&&r(),u.audio.play(),u.volume=t.volume||u.volume,u.loop=t.loop,u.currentTime=t.start||0,i(function(){u.play()},5))}),n.on("$destroy",function(){u.destroy()})}]}}]).directive("zlAudioHover",["$compile","$q","zlAudio",function(t,e,o){return{restrict:"AEC",controller:["$scope","$attrs","$element","$timeout",function(t,e,n,i){var r=o.load(e.zlAudioHover,t);n.on("mouseover rollover hover",function(){r.audio.play(),r.volume=e.volumeHover||r.volume,r.loop=e.loop,r.currentTime=e.startHover||0}),n.on("$destroy",function(){r.destroy()})}]}}]).service("localAudioFindingService",["$q",function(t){this.find=function(e){var o=t.defer(),n=document.getElementById(e);return n?o.resolve(n):o.reject(e),o.promise}}]).service("remoteAudioFindingService",["$q","zlAudioDomUid",function(t,e){this.find=function(o){var n=t.defer(),i=document.getElementById(e);if(i)i.pause(),i.src=o,i.load();else{var r=document.createElement("audio");r.style.display="none",r.id=e,r.src=o,document.body.appendChild(r),i=document.getElementById(e),i.load()}return i?n.resolve(i):n.reject(id),n.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(t,e,o){this.find=function(n){var i=t.defer();return n=n.replace("|","/"),e.find(n).then(i.resolve,function(){return o.find(n)}).then(i.resolve,i.reject),i.promise}}]).value("zlAudioGlobals",{muting:!1,performance:25,unlock:!0,volume:1}).factory("zlAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","zlAudioGlobals",function(t,e,o,n,i){return function(n,r){function u(){g&&(g.play(),g.pause()),window.removeEventListener("click",u)}function l(){T||(E&&o.cancel(E),d&&d(),s&&s(),T=!0)}function c(){T||(s=A.$watch(function(){return{volume:k.volume,currentTime:k.currentTime,progress:k.progress,muting:k.muting,loop:k.loop,playbackRate:k.playbackRate,globalVolume:i.volume}},function(t,e){t.currentTime!==e.currentTime&&k.setCurrentTime(t.currentTime),t.progress!==e.progress&&k.setProgress(t.progress),t.volume!==e.volume&&k.setVolume(t.volume),t.playbackRate!==e.playbackRate&&k.setPlaybackRate(t.playbackRate),t.globalVolume!==e.globalVolume&&(0===t.globalVolume?k.setMuting(!0):(k.setMuting(!1),k.setVolume(t.globalVolume))),m=t.loop,t.muting!==e.muting&&k.setMuting(t.muting)},!0))}function a(){if(s&&s(),g){if(b||i.muting?g.volume=0:g.volume=void 0!==k.volume?k.volume:1,v&&(g.play(),v=!1),p&&(g.pause(),g.currentTime=0,p=!1),h&&(g.pause(),h=!1),y&&(g.playbackRate=S,y=!1),f&&(g.volume=f,f=void 0),$){k.currentTime=g.currentTime,k.duration=g.duration,k.remaining=g.duration-g.currentTime,k.progress=0,k.paused=g.paused,k.src=g.src;var t=g.currentTime/g.duration;t>0&&(k.progress=t),k.currentTime>=k.duration&&M.forEach(function(t){t(k)}),z.forEach(function(t){k.duration-k.currentTime<=t.secs&&(t.callback(k),z.shift())}),m&&k.currentTime>=k.duration&&(m!==!0&&(m--,k.loop--),k.setCurrentTime(0),k.play())}b||i.muting||(k.volume=g.volume),k.audio=g}c()}var s,d,f,m,g,v=!1,h=!1,p=!1,y=!1,S=!1,b=!1,$=!0,T=!1,A=r||e,k=this;this.id=n,this.safeId=n.replace("/","|"),this.loop=0,this.unbind=function(){$=!1},this.play=function(){return v=!0,this};var M=[];this.complete=function(t){M.push(t)};var z=[];this.toFinish=function(t,e){z.push({secs:t,callback:e})},this.pause=function(){h=!0},this.restart=function(){p=!0},this.stop=function(){this.restart()},this.setVolume=function(t){f=t},this.setPlaybackRate=function(t){S=t,y=!0},this.setMuting=function(t){b=t},this.setProgress=function(t){g&&g.duration&&isFinite(t)&&(g.currentTime=g.duration*t)},this.setCurrentTime=function(t){g&&g.duration&&(g.currentTime=t)},this.destroy=l,A.$on("$destroy",function(){l()}),t.find(n).then(function(t){g=t,i.unlock&&(window.addEventListener("click",u),g.addEventListener("playing",function(){window.removeEventListener("click",u)})),g.addEventListener("canplay",function(){k.canPlay=!0})},function(t){k.error=!0,console.warn(t)});var E=o(a,i.performance);d=A.$watch(function(){return i.performance},function(){o.cancel(E),E=o(a,i.performance)})}}]).service("zlAudio",["zlAudioObject","zlAudioGlobals",function(t,e){this.play=function(e,o){var n=new t(e,o);return n.play(),n},this.load=function(e,o){return new t(e,o)},this.mute=function(){e.muting=!0},this.unmute=function(){e.muting=!1},this.toggleMute=function(){e.muting=!e.muting},this.setUnlock=function(t){e.unlock=t},this.setGlobalVolume=function(t){e.volume=t}}]).filter("zlTrackTime",function(){return function(t){var e=Math.floor(0|t),o="",n=0,i=0,r=0,u="0";return"undefined"!=typeof t&&(u=t.toString().split(".")[1]),e>3599?(n=Math.floor(e/3600),i=Math.floor((e-3600*n)/60),r=e-(60*i+3600*n),1==n.toString().length&&(n="0"+Math.floor(e/3600).toString()),1==i.toString().length&&(i="0"+Math.floor((e-3600*n)/60).toString()),1==r.toString().length&&(r="0"+(e-(60*i+3600*n)).toString()),o=n+":"+i+":"+r):e>59?(i=Math.floor(e/60),r=e-60*i,1==i.toString().length&&(i="0"+Math.floor(e/60).toString()),1==r.toString().length&&(r="0"+(e-60*i).toString()),o=i+":"+r):(r=e,1==r.toString().length&&(r="0"+e.toString()),o="00:"+r),"undefined"!=typeof u&&(o+="."+u.substring(0,1)),o}}).filter("trackTime",function(){return function(t){var e=Math.floor(0|t),o="",n=0,i=0,r=0;return e>3599?(n=Math.floor(e/3600),i=Math.floor((e-3600*n)/60),r=e-(60*i+3600*n),1==n.toString().length&&(n="0"+Math.floor(e/3600).toString()),1==i.toString().length&&(i="0"+Math.floor((e-3600*n)/60).toString()),1==r.toString().length&&(r="0"+(e-(60*i+3600*n)).toString()),o=n+":"+i+":"+r):e>59?(i=Math.floor(e/60),r=e-60*i,1==i.toString().length&&(i="0"+Math.floor(e/60).toString()),1==r.toString().length&&(r="0"+(e-60*i).toString()),o=i+":"+r):(r=e,1==r.toString().length&&(r="0"+e.toString()),o=e+"s"),"function"==typeof Number.isNaN&&Number.isNaN(o),o}});